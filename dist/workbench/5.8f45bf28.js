(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{266:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=C(a(2)),o=C(a(38)),n=C(a(6)),i=C(a(10)),u=C(a(4)),l=C(a(5)),s=a(1),d=C(s),c=(a(83),a(54)),p=(C(a(0)),a(281)),f=C(a(284));a(423);var g=a(294),h=C(a(421)),m=C(a(124)),v=a(398),y=C(a(397)),k=C(a(379));function C(e){return e&&e.__esModule?e:{default:e}}var D=function(e){function t(e){(0,n.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.state={selectCardIDList:[],moveModal:{selectedValue:1},currEditID:"",layout:{containerWidth:1200,containerHeight:300,calWidth:175,rowHeight:175,col:6,margin:[10,10],containerPadding:[0,0]},defaultLayout:{containerWidth:1200,containerHeight:300,calWidth:175,rowHeight:175,col:6,margin:[10,10],containerPadding:[0,0]}},a}return(0,l.default)(t,e),(0,i.default)(t,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){var e=this;(0,m.default)({url:"/nccloud/platform/appregister/queryapp.do",data:{cuserid:"1A"},success:function(t){if(t){var a=t.data,r=a.data,o=a.success;o&&r&&r.length>0&&(f.default.forEach(r,function(e){e.type="group"}),e.state.groups=r,e.setState({groups:r}))}}})}},{key:"deleteCard",value:function(e){var t=this.state,a=t.groups,r=t.selectCardIDList;f.default.forEach(a,function(t,a){f.default.remove(t.apps,function(t){return t.pk_appregister===e})}),f.default.remove(r,function(t){return t===e}),this.setState({groups:a,selectCardIDList:r})}},{key:"calColWidth",value:function(){var e=this.state.layout,t=e.containerWidth,a=e.col,r=e.containerPadding,o=e.margin;return o?(t-2*r[0]-o[0]*(a+1))/a:(t-2*r[0]-0*(a+1))/a}},{key:"calGridXY",value:function(e,t,a){var r=this.state.layout,o=r.margin,n=r.containerWidth,i=r.col,u=r.rowHeight,l=Math.floor(e/n*i),s=Math.floor(t/(u+(o?o[1]:0)));return console.log((0,v.checkInContainer)(l,s,i,a)),(0,v.checkInContainer)(l,s,i,a)}},{key:"dragCardToGroupItem",value:function(e,t,a,r){var o=this.calGridXY(a,r,e.width),n=o.GridX,i=o.GridY,u=this.state.groups,l=void 0,s=void 0;f.default.forEach(u,function(e,a){e.pk_app_group===t.id&&(l=a)}),f.default.forEach(u,function(t,a){if(0!==(s=f.default.remove(t.apps,function(t){return t.pk_appregister===e.id})).length)return!1}),s[0].gridx=n,s[0].gridy=i,u[l].apps.push(s[0]),this.setState({groups:u})}},{key:"onCheckboxChange",value:function(e,t){var a=this.state.selectCardIDList;e?a.push(t):f.default.remove(a,function(e){return e===t}),this.setState({selectCardIDList:a})}},{key:"editGroupItemName",value:function(e){this.setState({currEditID:e})}},{key:"getAddedGroupItemCount",value:function(){var e=0;return f.default.forEach(this.state.groups,function(t){-1!==t.pk_app_group.indexOf("newGroupItem")&&e++}),e}},{key:"addGroupItem",value:function(e){var t=this.state.groups,a=void 0;f.default.forEach(t,function(t,r){if(t.pk_app_group===e)return a=r,!1});var r={pk_app_group:"newGroupItem"+(new Date).getTime(),groupname:"分组("+(this.getAddedGroupItemCount()+1)+")",type:"group",apps:[]};t.splice(a+1,0,r),this.setState({groups:t})}},{key:"deleteGroupItem",value:function(e){var t=this.state.groups;t.length<=1||(f.default.remove(t,function(t){return t.pk_app_group===e}),this.setState({groups:t}))}},{key:"changeGroupName",value:function(e,t){var a=this.state.groups;f.default.forEach(a,function(a,r){if(a.pk_app_group===e)return a.groupname=t,!1}),this.setState({groups:a,currEditID:""})}},{key:"cancelGroupName",value:function(){this.setState({currEditID:""})}},{key:"moveGroupItem",value:function(e,t){var a=this.state.groups,r=a[e];a.splice(e,1),a.splice(t,0,r),this.setState({groups:a})}},{key:"onDrop",value:function(e,t){if(e.type!==t.type){for(var a=this.state.groups,r=void 0,o=void 0,n=void 0,i=void 0,u=0,l=a.length;u<l;u++){a[u].pk_app_group===t.id&&(o=u);for(var s=0,d=a[u].apps.length;s<d;s++){var c=a[u].apps;c[s].pk_appregister===e.id&&(r=c[s],n=s,i=u)}}a[i].apps.splice(n,1),a[o].apps.push(r),this.setState({groups:a})}}},{key:"resetContainer",value:function(e){this.setState({layout:e})}},{key:"createGroupItem",value:function(e,t,a,o,n){return d.default.createElement(k.default,(0,r.default)({key:e,id:e,groupname:t,type:a,index:o},this.state,{cards:n,layout:this.state.layout,defaultLayout:this.state.defaultLayout,currEditID:this.state.currEditID,onDrop:this.onDrop.bind(this),addGroupItem:this.addGroupItem.bind(this),deleteGroupItem:this.deleteGroupItem.bind(this),editGroupItemName:this.editGroupItemName.bind(this),moveGroupItem:this.moveGroupItem.bind(this),deleteCard:this.deleteCard.bind(this),changeGroupName:this.changeGroupName.bind(this),cancelGroupName:this.cancelGroupName.bind(this),dragCardToGroupItem:this.dragCardToGroupItem.bind(this),resetContainer:this.resetContainer.bind(this),onCheckboxChange:this.onCheckboxChange.bind(this)}))}},{key:"initGroupItem",value:function(e){var t=this,a=[];return f.default.forEach(e,function(e,r){a.push(t.createGroupItem(e.pk_app_group,e.groupname,e.type,r,e.apps))}),a}},{key:"deleteSelectedCardArr",value:function(){var e=this.state,t=e.selectCardIDList,a=e.groups;f.default.forEach(a,function(e,a){f.default.remove(e.apps,function(e){return-1!==f.default.indexOf(t,e.pk_appregister)})}),t=[],this.setState({selectCardIDList:t,groups:a}),console.log(this.state)}},{key:"onOkMoveDialog",value:function(e){var t=this.state,a=t.groups,r=t.selectCardIDList,o=[],n=void 0;f.default.forEach(a,function(t,a){t.pk_app_group===e&&(n=a);var i=f.default.remove(t.apps,function(e){return-1!==f.default.indexOf(r,e.pk_appregister)});o=f.default.concat(o,i)}),a[n].apps=f.default.concat(a[n].apps,o),r=[],this.setState({groups:a,selectCardIDList:r})}},{key:"saveGroupItemAndCard",value:function(){var e=[];f.default.forEach(this.state.groups,function(t,a){var r={groupname:t.groupname,apps:[],position:a};-1===t.pk_app_group.indexOf("newGroupItem")&&(r.pk_app_group=t.pk_app_group),f.default.forEach(t.apps,function(e){r.apps.push({pk_appregister:e.pk_appregister,gridx:e.gridx,gridy:e.gridy})}),e.push(r)});var t={cuserid:"1A",data:e};(0,m.default)({url:"/nccloud/platform/appregister/setapp.do",data:t,success:function(e){var t=e.data;t.data,t.success}})}},{key:"render",value:function(){var e=this.state,t=e.groups;e.apps;return d.default.createElement("div",{className:"nc-workbench-home-page"},d.default.createElement("div",{className:"nc-workbench-home-container"},this.initGroupItem(t)),d.default.createElement(y.default,(0,r.default)({},this.state,{saveGroupItemAndCard:this.saveGroupItemAndCard.bind(this),onOkMoveDialog:this.onOkMoveDialog.bind(this),deleteSelectedCardArr:this.deleteSelectedCardArr.bind(this)})))}}]),t}(s.Component);t.default=(0,g.DragDropContext)(h.default)((0,c.connect)(function(e){return{formData:e.formData,proData:e.proData}},{changeIntlData:p.changeIntlData,saveImg:p.saveImg,clearData:p.clearData})(D))},281:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearData=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(123));t.clearData=function(){return{type:r.CLEARDATA}}},378:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(a(274)),o=h(a(361)),n=h(a(38)),i=h(a(6)),u=h(a(10)),l=h(a(4)),s=h(a(5)),d=h(a(26));a(323),a(367);var c=a(1),p=h(c),f=(h(a(0)),a(294)),g=a(7);function h(e){return e&&e.__esModule?e:{default:e}}var m=(0,d.default)({beginDrag:function(e,t,a){return{id:e.id,type:e.type,width:e.w}},endDrag:function(e,t,a){},isDragging:function(e,t){e.drag233=t.getItem().id}},"endDrag",function(e,t,a){}),v={hover:function(e,t,a){if(t.getItem().id!=e.id){var r=(0,g.findDOMNode)(a).getBoundingClientRect(),o=(r.bottom,r.top,t.getClientOffset());o.y,r.top,r.left,o.x}},drop:function(e,t,a){if(_.isNull(t.getDropResult())){"group"===t.getItem().type?console.log("group in dropCard"):console.log("card in dropCard")}}};var y=function(e){function t(e){return(0,i.default)(this,t),(0,l.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,u.default)(t,[{key:"componentWillReceiveProps",value:function(e){!this.props.isOver&&e.isOver&&console.log("card enter"),this.props.isOver&&!e.isOver&&console.log("card leave")}},{key:"calGridItemPosition",value:function(e,t){var a=this.props,r=a.margin,o=a.rowHeight,n=a.calWidth;return r||(r=[0,0]),{x:Math.round(e*n+r[0]*(e+1)),y:Math.round(t*o+r[1]*(t+1))}}},{key:"calWHtoPx",value:function(e,t){var a=this.props,r=a.margin,o=a.calWidth,n=a.rowHeight;return{wPx:Math.round(e*o+(e-1)*r[0]),hPx:Math.round(t*n+(t-1)*r[1])}}},{key:"onCheckboxChange",value:function(e,t){this.props.onCheckboxChange(e.target.checked,t)}},{key:"isChecked",value:function(e){return-1!==_.indexOf(this.props.selectCardIDList,e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.connectDragSource,n=t.connectDropTarget,i=(t.isDragging,t.isOver),u=this.props,l=u.id,s=u.name,d=u.gridx,c=u.gridy,f=u.w,g=u.h,h=(this.props.deleteCard,this.calGridItemPosition(d,c)),m=h.x,v=h.y,y=this.calWHtoPx(f,g),k=y.wPx,C=y.hPx;return a(n(p.default.createElement("div",{className:"card",style:{width:k,height:C,background:i?"#ccc":"#fff",position:"absolute",border:"1px solid #f1f1f1","border-radius":"3px",transform:"translate("+m+"px, "+v+"px)",opacity:this.props.drag233===l?0:1}},p.default.createElement("div",{style:{"padding-left":"10px"}},s),p.default.createElement("div",null),p.default.createElement("div",{className:"card-footer"},p.default.createElement(o.default,{checked:this.isChecked(l),onChange:function(t){e.onCheckboxChange(t,l)}}),p.default.createElement(r.default,{type:"delete",className:"card-delete",onClick:function(){e.props.deleteCard(l)}})))))}}]),t}(c.Component);t.default=(0,f.DropTarget)("item",v,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}})((0,f.DragSource)("item",m,function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}})(y))},379:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=C(a(273)),o=C(a(329)),n=C(a(327)),i=C(a(274)),u=C(a(363)),l=C(a(2)),s=C(a(38)),d=C(a(6)),c=C(a(10)),p=C(a(4)),f=C(a(5));a(122),a(326),a(324),a(323),a(125);var g=a(1),h=C(g),m=(C(a(0)),a(7)),v=a(294),y=C(a(378)),k=C(a(284));function C(e){return e&&e.__esModule?e:{default:e}}var D={hover:function(e,t,a){if(t.getItem().type===e.type){var r=t.getItem().index,o=e.index;if(r!==o){var n=(0,m.findDOMNode)(a).getBoundingClientRect(),i=(n.bottom-n.top)/2,u=t.getClientOffset().y-n.top;r<o&&u<i||r>o&&u>i||(e.moveGroupItem(r,o),t.getItem().index=o)}}},drop:function(e,t,a){if(k.default.isNull(t.getDropResult())){var r=t.getItem(),o=e;if("group"===r.type)console.log("group in dropGroup"),e.onDrop(r,o);else{console.log("card in dropGroup");var n=t.getClientOffset(),i=n.x,u=n.y,l=(0,m.findDOMNode)(a).getBoundingClientRect(),s=l.x,d=l.y;e.dragCardToGroupItem(r,o,i-s,u-d)}}}};var _=function(e){function t(e){(0,d.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.getGroupName=function(e){var t=e.target.value;console.log(t),a.state.groupName=t},a.state={forbidDrag:!1,groupName:""},a}return(0,f.default)(t,e),(0,c.default)(t,[{key:"componentWillReceiveProps",value:function(e){!this.props.isOver&&e.isOver&&console.log("groupItem enter"),this.props.isOver&&!e.isOver&&console.log("groupItem leave")}},{key:"createCards",value:function(e){var t=this,a=[];return k.default.forEach(e,function(e){a.push(h.default.createElement(y.default,(0,l.default)({drag233:-1,type:e.apptype},e,{gridx:e.gridx,gridy:e.gridy,w:e.width,h:e.height,id:e.pk_appregister},t.props.layout,{key:e.pk_appregister,deleteCard:t.props.deleteCard,forbidDrag:t.state.forbidDrag,onCheckboxChange:t.props.onCheckboxChange,selectCardIDList:t.props.selectCardIDList})))}),a}},{key:"calCarContainerHeight",value:function(e){var t=k.default.chain(e).sortBy(["gridx","gridy"]).groupBy("gridx").value(),a=[];k.default.forEach(t,function(e){var t=e[e.length-1];a.push(t.gridy+t.height)});var r=k.default.max(a);return r*this.props.layout.rowHeight+(r-1)*this.props.layout.margin[1]+2*this.props.layout.margin[1]}},{key:"calColWidth",value:function(){var e=this.props.layout,t=e.containerWidth,a=e.col,r=e.containerPadding,o=e.margin;return o?(t-2*r[0]-o[0]*(a+1))/a:(t-2*r[0]-0*(a+1))/a}},{key:"componentDidMount",value:function(){var e=this.props.layout,t=document.querySelector("#card-container").clientWidth;this.props.layout.containerWidth=t;var a=this.calColWidth();e.calWidth=e.rowHeight=a,e.containerWidth=t,this.props.resetContainer(e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.isDragging,l=t.connectDragSource,s=t.connectDropTarget,d=t.isOver,c=t.groupname,p=t.id,f=t.cards,g=t.currEditID,m=t.defaultLayout,v=this.calCarContainerHeight(f),y=a?0:1,k=void 0;return k=g===p?h.default.createElement(o.default,{className:"group-item-title-container-edit"},h.default.createElement(n.default,{span:4},h.default.createElement("div",{className:"group-item-title-left"},h.default.createElement(u.default,{size:"small",placeholder:"占位符",defaultValue:c,onChange:this.getGroupName.bind(this)}),h.default.createElement(i.default,{type:"check-square-o",className:"group-item-icon",title:"占位符",onClick:function(){e.props.changeGroupName(p,e.state.groupName)}}),h.default.createElement(i.default,{type:"close-square-o",className:"group-item-icon",title:"占位符",onClick:function(){e.props.cancelGroupName()}})))):h.default.createElement(o.default,{className:"group-item-title-container-no-edit"},h.default.createElement(n.default,{span:2,className:"group-item-title-left"},h.default.createElement("div",null,h.default.createElement("span",null,c))),h.default.createElement(n.default,{span:3,className:"group-item-title-right",offset:19},h.default.createElement("div",{className:"group-item-title-edit"},h.default.createElement(i.default,{type:"edit",title:"占位符",className:"group-item-icon",onClick:function(){e.props.editGroupItemName(p)}})),h.default.createElement("div",{className:"group-item-title-edit"},h.default.createElement(i.default,{type:"close-square-o",title:"占位符",className:"group-item-icon",onClick:function(){e.props.deleteGroupItem(p)}})),h.default.createElement("div",{className:"group-item-title-edit"},h.default.createElement(i.default,{type:"plus-square-o",title:"占位符",className:"group-item-icon",onClick:function(){}})),h.default.createElement("div",{className:"group-item-title-edit"},h.default.createElement(i.default,{type:"ellipsis",title:"占位符",className:"group-item-icon",onClick:function(){}})))),l(s(h.default.createElement("div",{className:"group-item"},h.default.createElement("div",{className:"group-item-container",style:{background:d?"rgb(172, 175, 175)":"#ccc"}},k,h.default.createElement("section",{id:"card-container",style:{height:v>m.containerHeight?v:m.containerHeight,opacity:y}},this.createCards(this.props.cards))),h.default.createElement("div",null,h.default.createElement(r.default,{className:"group-item-add",onClick:function(){e.props.addGroupItem(p)}}," + 添加分组")))))}}]),t}(g.Component);t.default=(0,v.DropTarget)("item",D,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}})((0,v.DragSource)("item",{beginDrag:function(e,t,a){return{id:e.id,index:e.index,type:e.type}},isDragging:function(e,t){}},function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}})(_))},397:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(a(364)),o=m(a(329)),n=m(a(327)),i=m(a(273)),u=m(a(38)),l=m(a(6)),s=m(a(10)),d=m(a(4)),c=m(a(5)),p=m(a(362));a(386),a(326),a(324),a(122),a(382);var f=a(1),g=m(f),h=m(a(284));m(a(124));function m(e){return e&&e.__esModule?e:{default:e}}var v=p.default.Group,y=function(e){function t(e){(0,l.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));return a.getMoveCardButton=function(e,t){return 0===a.props.selectCardIDList.length?g.default.createElement(i.default,{disabled:!0},e):g.default.createElement(i.default,{onClick:function(){t(!0)}},e)},a.state={modalVisible:!1,selectedValue:0},a}return(0,c.default)(t,e),(0,s.default)(t,[{key:"getGroupItemNameRadio",value:function(e){var t=[];return h.default.forEach(e,function(e,a){t.push(g.default.createElement(p.default,{className:"modal-radio",key:e.pk_app_group,value:e.pk_app_group},e.groupname))}),g.default.createElement(v,{className:"modal-radio-group",value:this.state.selectedValue,onChange:this.onChangeRadio.bind(this)},t)}},{key:"setModalVisible",value:function(e){this.setState({modalVisible:e})}},{key:"onChangeRadio",value:function(e){this.setState({selectedValue:e.target.value})}},{key:"onOkMoveDialog",value:function(e){0!==this.state.selectedValue&&(this.setModalVisible(e),this.props.onOkMoveDialog(this.state.selectedValue))}},{key:"saveGroupItemAndCard",value:function(){this.props.saveGroupItemAndCard()}},{key:"cancleSave",value:function(){location.reload()}},{key:"render",value:function(){var e=this,t=this.props,a=t.groups,u=(t.moveModal,t.selectCardIDList,this.getGroupItemNameRadio(a));return g.default.createElement("div",{className:"nc-workbench-home-footer"},g.default.createElement("div",{className:"footer-container"},g.default.createElement(o.default,null,g.default.createElement(n.default,{span:1},this.getMoveCardButton("删除",this.props.deleteSelectedCardArr)),g.default.createElement(n.default,{span:1},this.getMoveCardButton("移动到",this.setModalVisible.bind(this))),g.default.createElement(n.default,{span:1,offset:18},g.default.createElement(i.default,{onClick:this.cancleSave.bind(this)},"取消")),g.default.createElement(n.default,{span:1},g.default.createElement(i.default,{onClick:this.saveGroupItemAndCard.bind(this)},"保存")))),g.default.createElement(r.default,{title:"移动到",wrapClassName:"vertical-center-modal",visible:this.state.modalVisible,onOk:function(){return e.onOkMoveDialog(!1)},onCancel:function(){return e.setModalVisible(!1)}},u))}}]),t}(f.Component);t.default=y},398:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.checkInContainer=function(e,t,a,r){return e+r>a-1&&(e=a-r),e<0&&(e=0),t<0&&(t=0),{GridX:e,GridY:t}}},423:function(e,t,a){}}]);